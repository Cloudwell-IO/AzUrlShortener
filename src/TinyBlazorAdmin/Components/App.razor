<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
    <link href="_content/Blazor.Bootstrap/blazor.bootstrap.css" rel="stylesheet" />
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="Cloud5mins.ShortenerTools.TinyBlazorAdmin.styles.css" />
    <HeadOutlet />
</head>

<body>
    <Routes />
    <script src="_framework/blazor.web.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.0.1/chart.umd.js" integrity="sha512-gQhCDsnnnUfaRzD8k1L5llCCV6O9HN09zClIzzeJ8OJ9MpGmIlCxm+pdCkqTwqJ4JcjbojFr79rl2F1mzcoLMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js" integrity="sha512-JPcRR8yFa8mmCsfrw4TNte1ZvF1e3+1SdGMslZvmrzDYxS69J7J49vkFL8u6u8PlPJK+H3voElBtUCzaXj+6ig==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="_content/Blazor.Bootstrap/blazor.bootstrap.js"></script>
    <!-- Set the default theme -->
    <script src="_content/Microsoft.FluentUI.AspNetCore.Components/js/loading-theme.js" type="text/javascript"></script>
    <loading-theme storage-name="theme"></loading-theme>
</body>

<script>
    // Local Storage Helper
    window.localStorageHelper = {
        setItem: function(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify(value));
                return true;
            } catch (e) {
                console.error('Error saving to localStorage:', e);
                return false;
            }
        },
        
        getItem: function(key) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : null;
            } catch (e) {
                console.error('Error reading from localStorage:', e);
                return null;
            }
        },
        
        removeItem: function(key) {
            try {
                localStorage.removeItem(key);
                return true;
            } catch (e) {
                console.error('Error removing from localStorage:', e);
                return false;
            }
        }
    };

    window.clipboardCopy = {
        copyText: function(text) {
            // Try native Share API on mobile devices (best UX)
            if (navigator.share && /Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                return navigator.share({
                    title: 'Short URL',
                    text: text,
                    url: text
                })
                .then(() => true)
                .catch((err) => {
                    // User cancelled or share failed, try clipboard
                    if (err.name === 'AbortError') {
                        return this.copyToClipboard(text);
                    }
                    console.warn('Share API failed:', err);
                    return this.copyToClipboard(text);
                });
            }
            
            // Use clipboard for desktop or if share not available
            return this.copyToClipboard(text);
        },
        
        copyToClipboard: function(text) {
            // Try modern clipboard API first (works on HTTPS and localhost)
            if (navigator.clipboard && window.isSecureContext) {
                return navigator.clipboard.writeText(text)
                    .then(() => true)
                    .catch((err) => {
                        console.warn('Clipboard API failed:', err);
                        return this.fallbackCopy(text);
                    });
            }
            
            // Use fallback for non-secure contexts
            return this.fallbackCopy(text);
        },
        
        fallbackCopy: function(text) {
            // Create a temporary text area
            const textArea = document.createElement('textarea');
            textArea.value = text;
            
            // Style to be invisible and off-screen
            textArea.style.position = 'fixed';
            textArea.style.top = '0';
            textArea.style.left = '0';
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            textArea.style.padding = '0';
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            textArea.style.background = 'transparent';
            textArea.style.opacity = '0';
            
            document.body.appendChild(textArea);
            
            try {
                // Focus and select
                textArea.focus();
                textArea.select();
                
                // For iOS devices
                if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                    const range = document.createRange();
                    range.selectNodeContents(textArea);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                    textArea.setSelectionRange(0, 999999);
                }
                
                // Try to copy
                const successful = document.execCommand('copy');
                
                if (!successful) {
                    throw new Error('Copy command was unsuccessful');
                }
                
                return Promise.resolve(true);
            } catch (err) {
                console.error('Fallback copy failed:', err);
                // Show user-friendly message
                alert('Unable to copy. Please copy the link manually: ' + text);
                return Promise.resolve(false);
            } finally {
                document.body.removeChild(textArea);
            }
        }
    };
</script>
</html>
